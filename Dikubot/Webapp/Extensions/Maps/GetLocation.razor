@using System.Threading
@using System.Net.Http.Json
@using Dikubot.Webapp.Extensions.Maps

<MudGrid>
	<MudItem xs="12">
		<MudAutocomplete T="Adresse" 
		                 Label="Adresse" 
		                 Value="Value"
		                 SearchFuncWithCancel="@Search" 
		                 Variant="Variant.Outlined" 
		                 ShowProgressIndicator="true" 
		                 ToStringFunc="@(e=> e==null?null : $"{e.forslagstekst}")"
		                 SelectValueOnTab = "true"
		                 ValueChanged="ValueChanged"/>
	</MudItem>
</MudGrid>


@code {
	
	
	[Inject] private HttpClient HttpClient { get; set; }
	[Parameter]
	public Adresse Value { get; set; }

	[Parameter]
	public EventCallback<Adresse> ValueChanged { get; set; }

	private async Task<IEnumerable<Adresse>> Search(string value, CancellationToken token)
	{
		return await HttpClient.GetFromJsonAsync<List<Adresse>>($"https://api.dataforsyningen.dk/autocomplete/?q={value ?? string.Empty}", token);
	}

	



}