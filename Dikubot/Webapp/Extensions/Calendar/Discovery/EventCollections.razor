@page "/discovery/events"
@inject UserService _userService;
@inject NavigationManager _navigationManager;
@using Dikubot.Extensions.Calender;
@using Dikubot.DataLayer.Database.Guild.Models.Calendar.Events
@using Dikubot.Extensions.search
@attribute [AllowAnonymous]

<Searchbar Items="Models" Context="item">
    <TemplateRow Context="item">
        <MudItem xs="12" sm="4"><EventWidget Model="item"></EventWidget></MudItem>
    </TemplateRow>
    <TemplatePagination>
        <MudIconButton Icon="@Icons.Filled.Add" Color="Color.Inherit" OnClick="() => {StartTime = StartTime.Subtract(TimeSpan.FromDays(30));}"> </MudIconButton>
    </TemplatePagination>
    </Searchbar>
    <MudButton Color="@Color.Primary" FullWidth="@true" OnClick="@Request" Style="margin-top: 15px;" Variant="Variant.Outlined">Tilføj dit event til KULiv.dk</MudButton>

@code
{
    public List<EventModel> Models { get => Services.Get(StartTime, DateTime.MaxValue, _userService);}
    
    private static readonly EventsServices Services = new EventsServices();
    
    private DateTime StartTime { get; set; } = DateTime.Today;

    protected override void OnInitialized()
    {
        
        base.OnInitialized();
    }
    
    
    
    private void Request()
    {
        _navigationManager.NavigateTo($"/Request/Event/create");
    }

}
