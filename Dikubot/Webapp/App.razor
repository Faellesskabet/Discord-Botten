@using Dikubot.DataLayer.Logic.WebDiscordBridge
@using global::Discord.WebSocket
@inject NavigationManager NavigationManager



<Blazorise.ThemeProvider Theme="@theme">
@if (IsSubdomainValid())
{
    <Layout>
        <LayoutContent>
            <CascadingAuthenticationState>
                <Router AppAssembly="@typeof(Startup).Assembly" PreferExactMatches="@true">
                    <Found Context="routeData">
                        <AuthorizeView>
                            <Authorized>
                                <AuthorizeRouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)"/>
                            </Authorized>
                            <NotAuthorized>
                                <Login AuthCode="@AuthCode"/>
                            </NotAuthorized>
                        </AuthorizeView>
                    </Found>
                    <NotFound>
                        <RedirectToBase/>
                    </NotFound>
                </Router>
                <MessageAlert />
            </CascadingAuthenticationState>
        </LayoutContent>
        <LayoutFooter><FooterComponent/></LayoutFooter>
    </Layout>
}
else
{
    <h1>Denne hjemmeside findes ikke</h1>
}
</Blazorise.ThemeProvider>

@code {
    [Parameter]
    public string AuthCode { get; set; }
    public bool IsSubdomainValid()
    {
        SocketGuild guild = SubDomainConnector.GetGuildFromDomain(NavigationManager.Uri);
        return guild != null;
    }
    
    private Theme theme = new Theme
    {
        IsRounded = false,
        ColorOptions = new ThemeColorOptions() {Success = "#4caf50"}
    };

}