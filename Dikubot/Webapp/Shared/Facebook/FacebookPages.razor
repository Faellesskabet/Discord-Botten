@page "/FacebookPages"
@using Dikubot.DataLayer.Database.Global.Facebook
@using System.Net.Http.Json
@using Dikubot.Webapp.Authentication
@inject FacebookPageService _FacebookPageService
@attribute [Authorize(Roles = Permissions.GlobalAdmin)]

<h3>FacebookPages</h3>

<MudDataGrid Items="@FacebookPagesList.Select(m => m.Item)">
    <Columns>
        <HierarchyColumn T="FBPage" />
                <Column T="FBPage" Field="Name" Title="Name">
                    <CellTemplate>
                        <MudText Typo="Typo.h4">  <MudAvatar Image="@_FacebookPageService.GetFBPicture(context.Item.Id,HttpClient)"/>  @context.Item.Name</MudText> 
                    </CellTemplate>
                </Column>
    </Columns>
     <ChildRowContent>
            <MudCard>
                <MudDataGrid Items="@_FacebookPageService.GetFBEvents(context.Item.Id, HttpClient)">
                    <Columns>
                        <Column T="FBEvent" Field="Name"  Title="Name" />
                        <Column T="FBEvent" Field="StartTime"  Title="Start tidspunkt" />
                        <Column T="FBEvent" Field="EndTime"  Title="Slut tidspunkt" />
                        <Column T="FBEvent" Field="Description"  Title="Description" />
                    </Columns>
                </MudDataGrid>
            </MudCard>
        </ChildRowContent>
</MudDataGrid>

@code {
    [Inject] private HttpClient HttpClient { get; set; }
    
    private List<FacebookPage> FacebookPagesList { get; set; }

    
    protected override void OnInitialized()
    {
        FacebookPagesList = _FacebookPageService.GetAll();
        base.OnInitialized();
    }


}